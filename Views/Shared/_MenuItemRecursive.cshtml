@model SAMLitigation.Models.ViewModel.MenuItemViewModel

@if (Model.IsDisplayable)
{
    @if (Model.Children != null && Model.Children.Any(c => c.IsDisplayable))
    {
        <!-- Parent with Children (Collapsible) -->
        <li data-level="@Model.Level">
            <a class="nav-link"
               data-bs-toggle="collapse"
               href="#menu-@Model.ChildID"
               role="button"
               aria-expanded="false"
               aria-controls="menu-@Model.ChildID">
                <span>
                    @if (Model.IsMenu)
                    {
                        <i class="bi bi-folder-fill me-2"></i>
                    }
                    else
                    {
                        <i class="bi bi-file-earmark me-2"></i>
                    }
                    @Model.DisplayName
                </span>
                <i class="bi bi-caret-down-fill"></i>
            </a>

            <!-- Recursive Children -->
            <ul class="collapse nav flex-column" id="menu-@Model.ChildID">
                @foreach (var child in Model.Children.Where(c => c.IsDisplayable).OrderBy(c => c.SeqNo))
                {
                    @await Html.PartialAsync("_MenuItemRecursive", child)
                }
            </ul>
        </li>
    }
    else
    {
        <!-- Leaf Node (No Children) - Link to Action -->
        <li data-level="@Model.Level">
            <a class="nav-link"
               asp-controller="@Model.ApplicationName"
               asp-action="@Model.ChildCode">
                <span>
                    @if (Model.IsMenu)
                    {
                        <i class="bi bi-file-earmark-fill me-2"></i>
                    }
                    else
                    {
                        <i class="bi bi-circle-fill me-2" style="font-size: 0.5rem;"></i>
                    }
                    @Model.DisplayName
                </span>
            </a>
        </li>
    }
}